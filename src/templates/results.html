<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IAM Detection Results</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <!-- Dark Cloud Security Theme -->
    <style>
        body {
            background: radial-gradient(circle at top, #0b1c2d, #050b12);
            color: #e6f1ff;
            min-height: 100vh;
        }

        h2 {
            font-weight: 700;
        }

        .card {
            background-color: #0f2235;
            border: 1px solid #1e3a5f;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(0, 229, 255, 0.08);
        }

        .card-header {
            background: linear-gradient(135deg, #b71c1c, #e53935);
            border-bottom: 1px solid #4a0f0f;
            font-weight: 600;
            color: #ffffff;
        }

        .alert-success {
            background-color: #0f3d2e;
            color: #a8f0c6;
            border: 1px solid #1e6f52;
        }

        .alert-danger {
            background-color: #3b1212;
            color: #ffb4b4;
            border: 1px solid #7a1e1e;
        }

        .table {
            color: #e6f1ff;
        }

        .table thead {
            background-color: #081624;
        }

        .table-bordered th,
        .table-bordered td {
            border-color: #1e3a5f;
        }

        .evidence-title {
            color: #4dd0e1;
            font-weight: 600;
        }

        .btn-secondary {
            background-color: #1e3a5f;
            border: none;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background-color: #2c4f7c;
        }

        footer {
            margin-top: 30px;
            font-size: 0.85rem;
            color: #6f8fb3;
            text-align: center;
        }
    </style>
</head>

<body>

<div class="container mt-5">

    <h2 class="mb-4">IAM Threat Detection Results</h2>

    {% if alerts|length == 0 %}
        <div class="alert alert-success">
            ‚úÖ No suspicious IAM activity detected.
        </div>
    {% else %}
        <div class="alert alert-danger">
            ‚ö†Ô∏è {{ alerts|length }} suspicious IAM activities detected.
        </div>

        {% for alert in alerts %}
        <div class="card mb-4">

            <div class="card-header">
                {{ alert.rule }} ‚Äî {{ alert.severity }}
            </div>

            <div class="card-body">
                <p><strong>Affected User:</strong> {{ alert.user_id }}</p>
                <p><strong>Details:</strong> {{ alert.details }}</p>

                <!-- Supporting Evidence -->
                <h6 class="evidence-title mt-4">
                    üìë Supporting Evidence
                </h6>

                <div class="table-responsive mt-2">
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>Event ID</th>
                                <th>Timestamp</th>
                                <th>Action</th>
                                <th>IP Address</th>
                                <th>Location</th>
                                <th>Role</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% set evidence_found = false %}
                            {% for log in logs %}
                                {% if log.event_id in alert.evidence_event_ids %}
                                    {% set evidence_found = true %}
                                    <tr>
                                        <td>{{ log.event_id }}</td>
                                        <td>{{ log.timestamp }}</td>
                                        <td>{{ log.action }}</td>
                                        <td>{{ log.ip_address }}</td>
                                        <td>{{ log.location }}</td>
                                        <td>{{ log.role }}</td>
                                    </tr>
                                {% endif %}
                            {% endfor %}

                            {% if not evidence_found %}
                                <tr>
                                    <td colspan="6" class="text-center text-muted">
                                        No matching evidence events available for this alert.
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
        {% endfor %}
    {% endif %}

    <a href="/" class="btn btn-secondary mt-3">
        ‚¨Ö Analyze Another Log File
    </a>

    <footer>
        Intelligent IAM Monitoring ‚Ä¢ Security Analysis Platform
    </footer>

</div>

</body>
</html>
